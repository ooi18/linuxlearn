05 | 基础篇：某个应用的CPU使用率居然达到100%，我该怎么办？
----

CPU 使用率
--

节拍率 HZ 是内核的可配置选项,可以设置为100,250,1000等.不同操作系统,可能设置的值不同,你可以通过查询 
`/boot/config` 内核选项来查看他的配置值.比如在我的系统中,为250,也就是每秒触发 250 次时间终端

    $ grep 'CONFIG_HZ'=' /boot/config-$(uname -r)
    CONFIG_HZ=250

同时,因为节拍率HZ为内核选项,所以用户控件程序并不能直接访问,为了方面用户空间程序访问,内核提供了一个用户控件节拍率 USER_HZ,它固定位100,也就是 1/100秒.


CPU 相关指标:

* user（通常缩写为 us），代表用户态 CPU 时间。注意，它不包括下面的 nice 时间，但包括了 guest 时间。
* nice（通常缩写为 ni），代表低优先级用户态 CPU 时间，也就是进程的 nice 值被调整为 1-19 之间时的 CPU 时间。这里注意，nice 可取值范围是 -20 到 19，数值越大，优先级反而越低。
* system（通常缩写为 sys），代表内核态 CPU 时间。
* idle（通常缩写为 id），代表空闲时间。注意，它不包括等待 I/O 的时间（iowait）。
* iowait（通常缩写为 wa），代表等待 I/O 的 CPU 时间。
* irq（通常缩写为 hi），代表处理硬中断的 CPU 时间。
* softirq（通常缩写为 si），代表处理软中断的 CPU 时间。
* steal（通常缩写为 st），代表当系统运行在虚拟机中的时候，被其他虚拟机占用的 CPU 时间。
* guest（通常缩写为 guest），代表通过虚拟化运行其他操作系统的时间，也就是运行虚拟机的 CPU 时间。
* guest_nice（通常缩写为 gnice），代表以低优先级运行虚拟机的时间。



压测

    ab -c 10 -n 10000 http://127.0.0.1:10000/

perf 添加 -g 开启调用关系分析,-p 指定进程号

    perf top -g -p 21111


perf 采样与展示

    # 采样
    perf record
    # 展示类似于 perf top 的报告 
    perf report